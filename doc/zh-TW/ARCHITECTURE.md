# ç³»çµ±æ¶æ§‹

> ğŸ“– [English Version](../ARCHITECTURE.md)

**Rokid AI Assistant ç³»çµ±è¨­è¨ˆèˆ‡æ¨¡çµ„é€šè¨ŠæŒ‡å—ã€‚**

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

```bash
# å»ºç½®ä¸¦å®‰è£å…¨éƒ¨æ¨¡çµ„
./gradlew installDebug

# åŸ·è¡Œå…ƒä»¶ç‰¹å®šå»ºç½®
./gradlew :phone-app:installDebug
./gradlew :glasses-app:installDebug
```

---

## ç¯„åœ

### æ¶µè“‹ç¯„åœ

- æ¨¡çµ„é–“é€šè¨Šå”å®š
- è³‡æ–™æµèˆ‡ç‹€æ…‹ç®¡ç†
- Rokid CXR SDK æ•´åˆæ¨¡å¼
- å»ºç½®è¨­å®šèˆ‡ç›¸ä¾æ€§åœ–

### ä¸æ¶µè“‹ç¯„åœ

- Rokid çœ¼é¡ç¡¬é«”è¦æ ¼
- ç¬¬ä¸‰æ–¹ AI æœå‹™å•†å…§éƒ¨å¯¦ä½œ
- ç¶²è·¯åŸºç¤æ¶æ§‹è¨­å®š

---

## ç›®éŒ„

- [ç³»çµ±æ¦‚è¦½](#ç³»çµ±æ¦‚è¦½)
- [æ¨¡çµ„æŒ‡å—](#æ¨¡çµ„æŒ‡å—)
- [é€šè¨Šæ¶æ§‹](#é€šè¨Šæ¶æ§‹)
- [è³‡æ–™æµ](#è³‡æ–™æµ)
- [æ¸¬è©¦](#æ¸¬è©¦)
- [FAQ èˆ‡ç–‘é›£æ’è§£](#faq-èˆ‡ç–‘é›£æ’è§£)

---

## ç³»çµ±æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä½¿ç”¨è€…äº’å‹•                                â”‚
â”‚                    èªéŸ³ / è¦–è¦º / æ‰‹å‹¢                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Rokid çœ¼é¡      â”‚â—„â”€â”€â”€ è—ç‰™ â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   æ‰‹æ©Ÿæ‡‰ç”¨        â”‚
â”‚   (glasses-app)   â”‚     CXR-M          â”‚   (phone-app)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç›¸æ©Ÿè¼¸å…¥        â”‚                   â”‚ â€¢ AI è™•ç†         â”‚
â”‚ â€¢ éº¥å…‹é¢¨è¼¸å…¥      â”‚                   â”‚ â€¢ é›²ç«¯ API å‘¼å«   â”‚
â”‚ â€¢ AR é¡¯ç¤ºè¼¸å‡º     â”‚                   â”‚ â€¢ æœ¬åœ°å„²å­˜        â”‚
â”‚ â€¢ å–šé†’è©åµæ¸¬      â”‚                   â”‚ â€¢ æ‰‹å‹¢è¾¨è­˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â–¼                           â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   AI æœå‹™     â”‚           â”‚   STT æœå‹™    â”‚
                            â”‚   Gemini      â”‚           â”‚   Whisper     â”‚
                            â”‚   OpenAI      â”‚           â”‚   Google      â”‚
                            â”‚   Anthropic   â”‚           â”‚   Azure       â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡çµ„æŒ‡å—

### å°ˆæ¡ˆçµæ§‹

```
RokidAIAssistant/
â”œâ”€â”€ app/                  # ç©ºæ®¼æ¨¡çµ„ï¼ˆAGP éœ€è¦ï¼‰
â”œâ”€â”€ phone-app/            # æ‰‹æ©Ÿä¸»æ‡‰ç”¨
â”‚   â””â”€â”€ src/main/
â”‚       â”œâ”€â”€ java/.../
â”‚       â”‚   â”œâ”€â”€ MainActivity.kt
â”‚       â”‚   â”œâ”€â”€ data/           # Repository, API clients
â”‚       â”‚   â”œâ”€â”€ domain/         # Use cases, entities
â”‚       â”‚   â””â”€â”€ ui/             # Compose screens
â”‚       â””â”€â”€ res/
â”œâ”€â”€ glasses-app/          # çœ¼é¡ AR é¡¯ç¤ºæ‡‰ç”¨
â”‚   â””â”€â”€ src/main/
â”‚       â””â”€â”€ java/.../
â”‚           â”œâ”€â”€ MainActivity.kt
â”‚           â”œâ”€â”€ service/        # CXR æœå‹™æ©‹æ¥
â”‚           â””â”€â”€ ui/             # AR overlay UI
â”œâ”€â”€ common/               # å…±ç”¨ç¨‹å¼ç¢¼
â”‚   â””â”€â”€ src/main/
â”‚       â””â”€â”€ java/.../
â”‚           â”œâ”€â”€ protocol/       # CXR è¨Šæ¯å”å®š
â”‚           â””â”€â”€ constants/      # å…±ç”¨å¸¸æ•¸
â””â”€â”€ doc/                  # æ–‡ä»¶
```

### æ¨¡çµ„ç›¸ä¾æ€§

| æ¨¡çµ„          | ç›¸ä¾æ–¼               | ç”¨é€”            |
| ------------- | -------------------- | --------------- |
| `phone-app`   | `common`             | ä¸» AI è™•ç†æ‡‰ç”¨  |
| `glasses-app` | `common`             | AR é¡¯ç¤ºèˆ‡è¼¸å…¥   |
| `common`      | -                    | å…±ç”¨å”å®šèˆ‡å·¥å…·  |
| `app`         | `phone-app` (æˆ–å…¶ä»–) | ç©ºæ®¼/æ¸¬è©¦é€²å…¥é» |

---

## é€šè¨Šæ¶æ§‹

### CXR å”å®š

æ‰‹æ©Ÿèˆ‡çœ¼é¡ä¹‹é–“çš„é€šè¨Šä½¿ç”¨ Rokid CXR SDKï¼š

```kotlin
// å®šç¾©æ–¼ common/src/.../protocol/CxrMessage.kt
sealed class CxrMessage {
    data class TextDisplay(val text: String) : CxrMessage()
    data class VoiceCommand(val audio: ByteArray) : CxrMessage()
    data class PhotoCapture(val imageData: ByteArray) : CxrMessage()
    data class StatusUpdate(val status: ConnectionStatus) : CxrMessage()
}
```

### è¨Šæ¯æµç¨‹

```
çœ¼é¡                            æ‰‹æ©Ÿ
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€ VoiceCommand â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                               â”‚ (STT è™•ç†)
  â”‚                               â”‚ (AI æ¨ç†)
  â”‚â—„â”€â”€â”€â”€ TextDisplay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€ PhotoCapture â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                               â”‚ (è¦–è¦ºåˆ†æ)
  â”‚â—„â”€â”€â”€â”€ TextDisplay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

---

## è³‡æ–™æµ

### AI å°è©±æµç¨‹

```
1. ä½¿ç”¨è€…è¼¸å…¥ï¼ˆèªéŸ³/æ–‡å­—/åœ–ç‰‡ï¼‰
      â”‚
      â–¼
2. è¼¸å…¥è™•ç†
   â”œâ”€â”€ èªéŸ³ â†’ STT æœå‹™ â†’ æ–‡å­—
   â””â”€â”€ åœ–ç‰‡ â†’ Base64 ç·¨ç¢¼
      â”‚
      â–¼
3. AI æœå‹™å‘¼å«
   â”œâ”€â”€ å»ºæ§‹è¨Šæ¯ï¼ˆå«æ­·å²ï¼‰
   â”œâ”€â”€ ä¸²æµå›æ‡‰
   â””â”€â”€ éŒ¯èª¤è™•ç†/é‡è©¦
      â”‚
      â–¼
4. å›æ‡‰è™•ç†
   â”œâ”€â”€ è§£æ Markdown
   â”œâ”€â”€ TTSï¼ˆå¯é¸ï¼‰
   â””â”€â”€ å„²å­˜åˆ°æ­·å²
      â”‚
      â–¼
5. è¼¸å‡ºåˆ°ä½¿ç”¨è€…
   â”œâ”€â”€ æ‰‹æ©Ÿ â†’ Compose UI
   â””â”€â”€ çœ¼é¡ â†’ CXR TextDisplay
```

### éŒ„éŸ³èˆ‡è‡ªå‹•åˆ†ææµç¨‹ï¼ˆæ–°åŠŸèƒ½ï¼‰

```
1. ä½¿ç”¨è€…é–‹å§‹éŒ„éŸ³
   â”œâ”€â”€ æ‰‹æ©ŸéŒ„éŸ³æŒ‰éˆ•
   â””â”€â”€ çœ¼é¡éŒ„éŸ³æŒ‰éˆ•
      â”‚
      â–¼
2. åœæ­¢éŒ„éŸ³
   â”œâ”€â”€ PCM è½‰æ› WAV æ ¼å¼
   â””â”€â”€ å„²å­˜åˆ° Room è³‡æ–™åº«
      â”‚
      â–¼
3. æª¢æŸ¥è‡ªå‹•åˆ†æè¨­å®š
   â”‚  (autoAnalyzeRecordings)
   â”‚
   â”œâ”€â”€ å·²å•Ÿç”¨ â†’ ç¹¼çºŒè‡ªå‹•è™•ç†
   â””â”€â”€ å·²åœç”¨ â†’ çµæŸï¼ˆåƒ…å„²å­˜ï¼‰
      â”‚
      â–¼
4. STT èªéŸ³è¾¨è­˜
   â”‚  (ä½¿ç”¨å·²è¨­å®šçš„ STT æœå‹™å•†)
   â”‚
      â–¼
5. AI åˆ†æ
   â”‚  (å°‡è¾¨è­˜çµæœå‚³é€çµ¦ AI)
   â”‚
      â–¼
6. è¼¸å‡ºçµæœ
   â”œâ”€â”€ æ›´æ–°è³‡æ–™åº«
   â”œâ”€â”€ æ›´æ–° UI å°è©±è¨˜éŒ„
   â””â”€â”€ çœ¼é¡é¡¯ç¤ºï¼ˆå¦‚å·²é€£æ¥ï¼‰
```

**é—œéµå¯¦ä½œé»ï¼š**

- `ApiSettings.autoAnalyzeRecordings` æ§åˆ¶è‡ªå‹•åˆ†æï¼ˆé è¨­ï¼šå•Ÿç”¨ï¼‰
- `ServiceBridge.transcribeRecordingFlow` è™•ç†éŒ„éŸ³äº‹ä»¶
- `PhoneAIService.processPhoneRecording()` ç·¨æ’å®Œæ•´å·¥ä½œæµç¨‹

### ç‹€æ…‹ç®¡ç†

```kotlin
// phone-app/src/.../ui/chat/ChatViewModel.kt
data class ChatUiState(
    val messages: List<ChatMessage> = emptyList(),
    val isLoading: Boolean = false,
    val error: String? = null,
    val connectionStatus: ConnectionStatus = Disconnected
)
```

---

## æ¸¬è©¦

### æ‰‹å‹•æ¸¬è©¦æ¸…å–®

| æ¸¬è©¦æ¡ˆä¾‹ | æ­¥é©Ÿ            | é æœŸçµæœ             |
| -------- | --------------- | -------------------- |
| CXR é€£æ¥ | çœ¼é¡ â†” æ‰‹æ©Ÿé…å° | é€£æ¥ç‹€æ…‹ = Connected |
| èªéŸ³è¼¸å…¥ | èªªå‡ºæŒ‡ä»¤        | æ–‡å­—é¡¯ç¤ºæ–¼å…©ç«¯       |
| AI å›æ‡‰  | å‚³é€è¨Šæ¯        | ä¸²æµå›æ‡‰åœ¨ < 3 ç§’    |
| æ‹ç…§     | çœ¼é¡è§¸ç™¼æ‹ç…§    | åœ–ç‰‡å‚³åˆ°æ‰‹æ©Ÿä¸¦åˆ†æ   |
| æ–·ç·šé‡é€£ | é—œé–‰è—ç‰™å†é–‹å•Ÿ  | è‡ªå‹•é‡æ–°é€£æ¥         |

### åŸ·è¡Œå–®å…ƒæ¸¬è©¦

```bash
# å…¨éƒ¨æ¸¬è©¦
./gradlew test

# ç‰¹å®šæ¨¡çµ„
./gradlew :phone-app:testDebugUnitTest
./gradlew :common:test
```

---

## FAQ èˆ‡ç–‘é›£æ’è§£

### æ¶æ§‹å•é¡Œ

**Q: ç‚ºä»€éº¼åˆ†æˆ phone-app å’Œ glasses-appï¼Ÿ**

```
A: ç¡¬é«”åˆ†é›¢ - çœ¼é¡è™•ç†èƒ½åŠ›æœ‰é™ï¼Œä¸»è¦è™•ç†åœ¨æ‰‹æ©ŸåŸ·è¡Œã€‚
   CXR SDK ä¹Ÿéœ€è¦åˆ†é›¢çš„å®¢æˆ¶ç«¯ï¼ˆMï¼‰å’Œæœå‹™ç«¯ï¼ˆSï¼‰æ¨¡çµ„ã€‚
```

**Q: common æ¨¡çµ„åŒ…å«ä»€éº¼ï¼Ÿ**

```
A: å…±ç”¨çš„å”å®šå®šç¾©ã€å¸¸æ•¸ã€å·¥å…·å‡½å¼ã€‚
   ç¢ºä¿å…©ç«¯ä½¿ç”¨ç›¸åŒçš„è¨Šæ¯æ ¼å¼ã€‚
```

**Q: å¦‚ä½•æ–°å¢ AI æœå‹™å•†ï¼Ÿ**

```
A: 1. å¯¦ä½œ AiProvider ä»‹é¢
   2. åœ¨ ProviderFactory è¨»å†Š
   3. æ›´æ–° SettingsScreen UI
   4. åœ¨ local.properties æ–°å¢é‡‘é‘°
```

### å»ºç½®å•é¡Œ

**Q: å»ºç½®å¤±æ•—é¡¯ç¤ºç›¸ä¾æ€§è¡çª**

```bash
# æª¢æŸ¥ç›¸ä¾æ€§æ¨¹
./gradlew :phone-app:dependencies --configuration releaseRuntimeClasspath

# å¼·åˆ¶è§£æ
configurations.all {
    resolutionStrategy {
        force("com.example:library:1.0.0")
    }
}
```

**Q: Gradle sync å¤±æ•—**

```
A: 1. File â†’ Invalidate Caches / Restart
   2. åˆªé™¤ .gradle å’Œ build è³‡æ–™å¤¾
   3. é‡æ–° sync
```

### é€šè¨Šå•é¡Œ

**Q: CXR é€£æ¥ä¸ç©©å®š**

```
A: 1. ç¢ºèªè—ç‰™æ¬Šé™å·²æˆäºˆ
   2. æª¢æŸ¥ ROKID_CLIENT_SECRET æ­£ç¢º
   3. é‡å•Ÿå…©ç«¯æ‡‰ç”¨
   4. æŸ¥çœ‹ Logcat ä¸­çš„ CXR æ¨™ç±¤
```

**Q: è¨Šæ¯å»¶é²é«˜**

```
A: 1. æª¢æŸ¥ç¶²è·¯é€£æ¥ï¼ˆAI API éœ€è¦ï¼‰
   2. å˜—è©¦å»¶é²è¼ƒä½çš„æœå‹™å•†ï¼ˆå¦‚ Groqï¼‰
   3. æ¸›å°‘è¨Šæ¯æ­·å²é•·åº¦
```

---

## å»ºç½®èˆ‡åŸ·è¡Œ

### Debug vs Release

| è¨­å®š         | Debug            | Release          |
| ------------ | ---------------- | ---------------- |
| Minification | âŒ               | âœ… R8            |
| é™¤éŒ¯ç¬¦è™Ÿ     | âœ…               | âŒ               |
| API é‡‘é‘°ä¾†æº | local.properties | local.properties |
| å»ºç½®æ™‚é–“     | å¿«               | æ…¢               |
| APK å¤§å°     | è¼ƒå¤§             | è¼ƒå°             |

### å¸¸è¦‹é–‹ç™¼ä»»å‹™

| ä»»å‹™                   | æŒ‡ä»¤                                  |
| ---------------------- | ------------------------------------- |
| å»ºç½®ä¸¦å®‰è£ phone-app   | `./gradlew :phone-app:installDebug`   |
| å»ºç½®ä¸¦å®‰è£ glasses-app | `./gradlew :glasses-app:installDebug` |
| åŸ·è¡Œæ¸¬è©¦               | `./gradlew test`                      |
| æ¸…ç†å»ºç½®               | `./gradlew clean`                     |
| æª¢æŸ¥ç›¸ä¾æ€§æ›´æ–°         | `./gradlew dependencyUpdates`         |
| ç”¢ç”Ÿ Release APK       | `./gradlew assembleRelease`           |
